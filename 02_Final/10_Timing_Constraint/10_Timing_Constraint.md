# ASIC 설계에서의 타이밍 제약 (Timing Constraints in ASIC Design)

## 기본 개념 (Fundamental Concepts)

### 실제 회로에서의 지연 요소 (Delay Components in Real Circuits)

* 실제 회로는 MOSFET과 배선에 존재하는 저항과 커패시턴스 때문에 항상 지연을 가진다.
* 전파 지연 (Propagation Delay): 입력이 올바르고 안정된 이후 출력이 올바르고 안정될 때까지 걸리는 시간으로, 출력이 안정되기까지의 최대 시간을 의미한다.
* 오염 지연 (Contamination Delay): 입력이 처음 변화한 순간부터 출력이 처음 반응하기까지의 시간으로, 출력이 변하기 시작하는 최소 시간을 의미한다.
* 모든 배선은 저항과 커패시턴스를 동시에 포함하며, RC 지연 경로를 형성한다.
* 저항 경로를 따라 커패시터를 단계적으로 충전하는 과정에서 신호 전파 지연이 발생한다.

## D 플립플롭의 타이밍 파라미터 (D Flip-Flop Timing Parameters)

* 셋업 타임 (Setup Time, $t_s$ 또는 $t_{su}$): 클럭 상승 에지 이전에 D 입력이 최소한 이 시간만큼 먼저 도착해야 한다.
* 홀드 타임 (Hold Time, $t_h$): 클럭 상승 에지 이후에 D 입력이 최소한 이 시간 동안 안정적으로 유지되어야 한다.
* $t_{dCQ}$ / $t_{pd}$: 클럭 상승 에지부터 Q 출력이 안정될 때까지의 전파 지연.
* $t_{cCQ}$: 클럭 상승 에지부터 Q 출력이 처음 변하기 시작할 때까지의 오염 지연.
* 셋업 타임 또는 홀드 타임을 위반하면 올바른 데이터 샘플링을 보장할 수 없다.

## 셋업 타임 제약 분석 (Setup Time Constraint Analysis)

### 정의 및 수식 (Definition and Formula)

* 셋업 타이밍 슬랙
  $$
  t_{\text{slack}} = t_{cy} - (t_s + t_{dab} + t_{dCQ})
  $$
* $t_{cy}$: 클럭 주기
* $t_s$: 셋업 타임 (플립플롭 데이터시트)
* $t_{dab}$: 조합 논리의 전파 지연
* $t_{dCQ}$: 클럭에서 Q까지의 전파 지연
* $t_{\text{slack}} \ge 0$: 셋업 제약 만족, 동작 보장
* $t_{\text{slack}} < 0$: 셋업 위반 발생, 데이터가 충분히 일찍 도착하지 않음

### 셋업 위반 해결 방법 (Methods to Solve Setup Violations)

1. 클럭 주기 증가 ($t_{cy}$)
   * 가장 간단한 방법
   * 전체 시스템 속도에 영향을 줌
   * 제조 이후에도 가능

2. 전파 지연 감소 ($t_{dMax}$)

   * 표준 셀의 구동 능력 증가 (커패시턴스 증가와의 트레이드오프 고려)
   * 논리 게이트 수 감소 (항상 효과적인 것은 아님)
   * 파이프라인 구조를 사용하여 조합 논리를 분할
   * 최적의 게이트 사이징 탐색

3. 클럭 스큐 조정

   * 후단 플립플롭에 지연을 추가하여 셋업 여유 시간 증가

## 파이프라인 구조 (Pipeline Structure)

* 긴 조합 논리 경로를 분할하기 위해 D 플립플롭을 삽입한다.
* 여러 연산을 동시에 처리할 수 있어 처리량이 증가한다.
* 처리량 효과: 사이클당 1개 연산 -> 여러 연산 가능
* 레이턴시 고려: 단일 연산의 레이턴시는 증가 (여러 클럭 필요)
* 문제점:

  * 각 파이프라인 단계의 전파 지연 균형 필요
  * 가장 느린 단계가 전체 처리량을 제한
  * 다른 단계들은 유휴 상태가 됨
* 정확한 지연 예측과 분할 전략이 필요하다.

## 홀드 타임 제약 분석 (Hold Time Constraint Analysis)

### 정의 및 수식 (Definition and Formula)

* 홀드 타이밍 슬랙
  $$
  t_{\text{slack}} = t_{cCQ} + t_{ccd} - t_h
  $$
* $t_{cCQ}$: 클럭 -> Q 오염 지연
* $t_{ccd}$: 조합 논리의 오염 지연 (최소 지연)
* $t_h$: 홀드 타임
* $t_{\text{slack}} \ge 0$: 홀드 제약 만족
* $t_{\text{slack}} < 0$: 홀드 위반 발생, 데이터가 너무 빨리 변함

### 셋업 타임과의 핵심 차이 (Key Difference from Setup Time)

* 홀드 타임은 최대 지연이 아니라 최소 지연을 사용한다.
* 클럭 상승 이후 일정 시간 동안 입력 데이터가 유지되어야 한다.
* 최단 경로(min path)에 초점을 둔다.

### 홀드 위반 해결 방법 (Methods to Solve Hold Violations)

1. 오염 지연 증가

   * 조합 논리에 버퍼 삽입
   * AND, OR, NOT 같은 추가 논리 삽입
   * EDA 툴이 자동으로 버퍼 삽입 수행

2. 파이프라인 병합

   * 불필요한 파이프라인 레지스터 제거

3. 주의사항

   * 클럭 주기 조정은 홀드 위반을 해결하지 못한다.
   * 홀드 위반은 제조 이후 수정 불가
   * 테이프아웃 전에 반드시 해결해야 한다.
   * 제조 후 홀드 위반이 발생하면 칩 동작을 보장할 수 없다.

## 클럭 스큐 고려사항 (Clock Skew Considerations)

### 정의 (Definition)

* 클럭 스큐 ($t_k$): 서로 다른 레지스터에 클럭이 도달하는 시간 차이
* 실제 회로에서는 클럭이 동시에 도착하지 않는다.
* 의도적(지연 삽입) 또는 비의도적(배선 지연)일 수 있다.

### 셋업 타임에 대한 영향 (Effect on Setup Time Constraint)

* 전단 플립플롭 지연 시
  $$
  t_{\text{slack}} = t_{cy} + t_k - (t_s + t_{dab} + t_{dCQ})
  $$

  * 셋업 위반 가능성 증가 (부정적)

* 후단 플립플롭 지연 시
  $$
  t_{\text{slack}} = t_{cy} - t_k - (t_s + t_{dab} + t_{dCQ})
  $$

  * 셋업 여유 증가 (긍정적)

* 권장: 셋업 위반 해결을 위해 후단 플립플롭에 지연 삽입

### 홀드 타임에 대한 영향 (Effect on Hold Time Constraint)

* 후단 플립플롭 지연 시
  $$
  t_{\text{slack}} = t_{cCQ} + t_{ccd} - t_h - t_k
  $$

  * 홀드 위반 위험 증가

* 전단 플립플롭 지연 시
  $$
  t_{\text{slack}} = t_{cCQ} + t_{ccd} - t_h + t_k
  $$

  * 홀드 여유 증가

* 권장: 홀드 위반 해결을 위해 전단 플립플롭에 지연 삽입

* 주의: 홀드 해결을 위한 스큐 조정은 셋업을 악화시킬 수 있다.

## 실전 설계 예제 (Practical Design Examples)

### 예제 1: 단순 회로 분석

* 플립플롭:
  ($t_s = 50$) ps, ($t_h = 40$) ps,
  ($t_{dCQ} = t_{cCQ} = 60$) ps

* 조합 논리:
  ($t_{dMax} = 800$) ps, ($t_{cMin} = 50$) ps
* 클럭 주파수: 1 GHz (주기 = 1000 ps)

* 셋업 슬랙:
  $$
  1000 - (50 + 800 + 60) = 90 \text{ ps}
  $$

* 홀드 슬랙:
  $$
  60 + 50 - 40 = 70 \text{ ps}
  $$

### 예제 2: 16비트 리플 캐리 가산기 누산 구조

* 회로: (q = q + A)
* 크리티컬 패스: 16개의 풀 가산기 + 플립플롭
* 풀 가산기 지연: 30 ps
* 조합 논리 지연: ($16 \times 30 = 480$) ps
* 최소 클럭 주기:
  $$
  480 + 60 + 20 = 560 \text{ ps}
  $$
* 최대 주파수: 약 1.79 GHz
* 홀드 위반 예:

  * 후단 플립플롭에 20 ps 스큐
  * 홀드 슬랙: (-10) ps
* 해결책: 가산기 단계 사이에 추가 지연 삽입

## 크리티컬 패스 개념 (Critical Path Concept)

### 정의

* 크리티컬 패스: 회로에서 가장 긴 전파 지연을 가지는 경로
* 시스템의 최대 클럭 주파수를 결정한다.
* 최악의 경우 데이터 경로가 시스템 속도를 제한한다.

### 중요성

* 크리티컬 패스 최적화가 시스템 속도 향상의 핵심이다.
* 다른 경로들은 이미 충분히 빠른 경우가 많다.
* 비크리티컬 경로 최적화는 속도에 영향을 주지 않는다.
* 하나를 해결하면 새로운 크리티컬 패스가 생길 수 있다.

## 타이밍 슬랙 및 마진 개념 (Timing Slack and Margin Concepts)

### 셋업 타이밍 슬랙

* 셋업 제약에 대한 여유 시간
* 양수: 안정
* 0: 최소 동작 조건
* 음수: 주기 증가 또는 지연 감소 필요

### 홀드 타이밍 슬랙

* 홀드 제약에 대한 여유 시간
* 음수일 경우 설계 단계에서 반드시 수정 필요

## 설계 방법론 및 모범 사례 (Design Methodology and Best Practices)

### 파이프라인 설계 절차

1. 전체 조합 논리 지연 추정
2. 병목 구간 식별
3. 블록 다이어그램 작성
4. 지연 분포 기반 단계 분할
5. 플립플롭 삽입
6. 셋업/홀드 위반 검증
7. 처리량 및 레이턴시 평가

## 중요 공식 요약 (Important Formulas Summary)

* 셋업 슬랙:
  $$
  t_{cy} - (t_s + t_{dab} + t_{dCQ})
  $$
* 홀드 슬랙:
  $$
  t_{cCQ} + t_{ccd} - t_h
  $$
* 최대 주파수:
  $$
  f = \frac{1}{t_{cy}}
  $$

## 용어 정리 (Terminology Reference)

* $t_{cy}$: 클럭 주기
* $t_s$, $t_{su}$: 셋업 타임
* $t_h$: 홀드 타임
* $t_{dCQ}$: 클럭->Q 전파 지연
* $t_{cCQ}$: 클럭->Q 오염 지연
* Latency: 단일 연산 완료 시간
* Throughput: 단위 시간당 처리 연산 수